

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>DeDuplication of EBU-TT-Live documents &mdash; EBU-TT-Live Toolkit 2.1.2 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/graphviz.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Conversion of EBU-TT-Live documents to EBU-TT-D documents" href="conversion.html" />
    <link rel="prev" title="Segmentation of EBU-TT-Live document sequences" href="segmentation.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> EBU-TT-Live Toolkit
          

          
          </a>

          
            
            
              <div class="version">
                2.1.2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="overview.html">Overview of the EBU-TT live toolkit.</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="nodes_and_carriage_mechanisms.html">Nodes and Carriage Mechanisms</a></li>
<li class="toctree-l2"><a class="reference internal" href="scripts_and_their_functions.html">Scripts and their functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="configurator.html">Configuration files and <code class="docutils literal notranslate"><span class="pre">ebu-run</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="validation.html">Document and sequence validation</a></li>
<li class="toctree-l2"><a class="reference internal" href="user_input_producer.html">User input producer</a></li>
<li class="toctree-l2"><a class="reference internal" href="timing_resolution.html">Timing resolution and consumer logic</a></li>
<li class="toctree-l2"><a class="reference internal" href="segmentation.html">Segmentation of EBU-TT-Live document sequences</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">DeDuplication of EBU-TT-Live documents</a></li>
<li class="toctree-l2"><a class="reference internal" href="conversion.html">Conversion of EBU-TT-Live documents to EBU-TT-D documents</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="ebu_tt_live.html">Source code reference</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">EBU-TT-Live Toolkit</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
          <li><a href="overview.html">Overview of the EBU-TT live toolkit.</a> &raquo;</li>
        
      <li>DeDuplication of EBU-TT-Live documents</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/deduplication.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="deduplication-of-ebu-tt-live-documents">
<h1>DeDuplication of EBU-TT-Live documents<a class="headerlink" href="#deduplication-of-ebu-tt-live-documents" title="Permalink to this headline">¶</a></h1>
<p>When documents are ReSequenced, duplication of <code class="docutils literal notranslate"><span class="pre">style</span></code> and <code class="docutils literal notranslate"><span class="pre">region</span></code> elements
and attributes can occur. To address this, the DeDuplicator node processes the
document(s) with the
<a class="reference internal" href="ebu_tt_live.node.html#ebu_tt_live.node.deduplicator.DeDuplicatorNode.remove_duplication" title="ebu_tt_live.node.deduplicator.DeDuplicatorNode.remove_duplication"><code class="xref py py-func docutils literal notranslate"><span class="pre">ebu_tt_live.node.deduplicator.DeDuplicatorNode.remove_duplication()</span></code></a> function.</p>
<p>After copying <code class="docutils literal notranslate"><span class="pre">styling</span></code> and <code class="docutils literal notranslate"><span class="pre">layout</span></code> into a <code class="docutils literal notranslate"><span class="pre">list()</span></code> and setting them up for new
<code class="docutils literal notranslate"><span class="pre">style</span></code> and <code class="docutils literal notranslate"><span class="pre">region</span></code> elements, respectively, the <code class="docutils literal notranslate"><span class="pre">list()</span></code> is passed through the
<a class="reference internal" href="ebu_tt_live.node.html#ebu_tt_live.node.deduplicator.DeDuplicatorNode.CollateUniqueVals" title="ebu_tt_live.node.deduplicator.DeDuplicatorNode.CollateUniqueVals"><code class="xref py py-func docutils literal notranslate"><span class="pre">ebu_tt_live.node.deduplicator.DeDuplicatorNode.CollateUniqueVals()</span></code></a> function.</p>
<p>Because <code class="docutils literal notranslate"><span class="pre">style</span></code> and <code class="docutils literal notranslate"><span class="pre">region</span></code> elements can have <code class="docutils literal notranslate"><span class="pre">style</span></code> attributes, these
are deduplicated first. At this stage, it’s possible that where two identical elements
that differed only in their style references, these may end up looking the same.
Each element is then passed through the
<a class="reference internal" href="ebu_tt_live.node.html#ebu_tt_live.node.deduplicator.ComparableElement" title="ebu_tt_live.node.deduplicator.ComparableElement"><code class="xref py py-class docutils literal notranslate"><span class="pre">ebu_tt_live.node.deduplicator.ComparableElement</span></code></a> class, which processes
each attribute, omitting the <code class="docutils literal notranslate"><span class="pre">xml:id</span></code> and using the
<a class="reference internal" href="ebu_tt_live.node.html#ebu_tt_live.node.deduplicator.ReplaceNone" title="ebu_tt_live.node.deduplicator.ReplaceNone"><code class="xref py py-func docutils literal notranslate"><span class="pre">ebu_tt_live.node.deduplicator.ReplaceNone()</span></code></a> function to replace empty
attributes with a non-legal character to avoid collisions, and assigns a hash
to each element. The hash is then stored in <code class="docutils literal notranslate"><span class="pre">old_id_dict</span></code> as a key-value pair,
where the <code class="docutils literal notranslate"><span class="pre">xml:id</span></code> is the <code class="docutils literal notranslate"><span class="pre">key</span></code> and the hash is the <code class="docutils literal notranslate"><span class="pre">value</span></code>. The hash is also stored
in <code class="docutils literal notranslate"><span class="pre">hash_dict</span></code> where the hash is the <code class="docutils literal notranslate"><span class="pre">key</span></code>, and the <code class="docutils literal notranslate"><span class="pre">value</span></code> is the contents of the element.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">list()</span></code> is then passed through the <a class="reference internal" href="ebu_tt_live.node.html#ebu_tt_live.node.deduplicator.DeDuplicatorNode.AppendNewElements" title="ebu_tt_live.node.deduplicator.DeDuplicatorNode.AppendNewElements"><code class="xref py py-func docutils literal notranslate"><span class="pre">ebu_tt_live.node.deduplicator.DeDuplicatorNode.AppendNewElements()</span></code></a>
function, which takes in the list of elements, the path to the parent element
(<code class="docutils literal notranslate"><span class="pre">styling</span></code> or <code class="docutils literal notranslate"><span class="pre">layout</span></code>), <code class="docutils literal notranslate"><span class="pre">old_id_dict</span></code>, <code class="docutils literal notranslate"><span class="pre">new_id_dict</span></code> and <code class="docutils literal notranslate"><span class="pre">hash_dict</span></code></p>
<p>The function iterates through the key-value pairs of <code class="docutils literal notranslate"><span class="pre">hash_dict</span></code> and the contents
of the list of elements; where the <code class="docutils literal notranslate"><span class="pre">xml:id</span></code> of both matches, the element is appended to
the parent element. The hash and <code class="docutils literal notranslate"><span class="pre">xml:id</span></code> is then stored in <code class="docutils literal notranslate"><span class="pre">new_id_dict</span></code>,
where the hash is the <code class="docutils literal notranslate"><span class="pre">key</span></code> and the <code class="docutils literal notranslate"><span class="pre">xml:id</span></code> is the <code class="docutils literal notranslate"><span class="pre">value</span></code>.</p>
<p>In the final step, before emitting the document, the document as it is at this stage is passed
through the <a class="reference internal" href="ebu_tt_live.node.html#ebu_tt_live.node.deduplicator.ReplaceStylesAndRegions" title="ebu_tt_live.node.deduplicator.ReplaceStylesAndRegions"><code class="xref py py-class docutils literal notranslate"><span class="pre">ebu_tt_live.node.deduplicator.ReplaceStylesAndRegions</span></code></a> class.
This utilises RecursiveOperation i.e. this class is used to recursively fix
the style and region attribute values, by addressing where a <code class="docutils literal notranslate"><span class="pre">style</span></code> or <code class="docutils literal notranslate"><span class="pre">region</span></code>
attribute has been declared, and replaces the reference to the old <code class="docutils literal notranslate"><span class="pre">xml:id</span></code> with
the new one stored in <code class="docutils literal notranslate"><span class="pre">new_id_dict</span></code>, which is done by taking the reference to
the old <code class="docutils literal notranslate"><span class="pre">xml:id</span></code>, matching it to the key in <code class="docutils literal notranslate"><span class="pre">old_id_dict</span></code> to find the hash
<code class="docutils literal notranslate"><span class="pre">value</span></code>, then matching the hash to the <code class="docutils literal notranslate"><span class="pre">key</span></code> in <code class="docutils literal notranslate"><span class="pre">new_id_dict</span></code> to get the
new <code class="docutils literal notranslate"><span class="pre">xml:id</span></code> reference. While doing this, it also deduplicates instances where
multiple <code class="docutils literal notranslate"><span class="pre">style</span></code> attributes have been referenced, removing duplicates while
maintaining the hierarchy in which they were declared.</p>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="conversion.html" class="btn btn-neutral float-right" title="Conversion of EBU-TT-Live documents to EBU-TT-D documents" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="segmentation.html" class="btn btn-neutral float-left" title="Segmentation of EBU-TT-Live document sequences" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, European Broadcasting Union

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>